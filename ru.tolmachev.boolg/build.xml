<?xml version="1.0" encoding="UTF-8"?> 
<project name="project" default="default">
	<property name="lexerProject" value="../com.googlecode.alvor.sqllexer"></property>
	<property name="parserProject" value="../com.googlecode.alvor.sqlparser"></property>
	<taskdef classname="JFlex.anttask.JFlexTask" name="jflex" classpath="${lexerProject}/lib/JFlex.jar"/>

	<target name="default" depends="generateLexer" description="description">
    </target>

    <target name="generateParser">
        <echo message="${basedir}"/>
		<!-- New GLR-parser -->
    	<java 
    		classpath="${parserProject}/bin" 
    		classname="com.googlecode.alvor.sqlparser.SpecGeneratorMain"
    	>
    		<arg value="resources/programming_language/pl.bgtemplate"/>
    		<arg value="generated/pl.bg"/>
    		<arg value="resources/programming_language/pl.flextemplate"/>
    		<arg value="generated/pl.flex"/>
    		<arg value="generated/pl.keywords"/>
    	</java>
<!--
    	<arg value="- -language=Java"/>
			<arg value="- -debug"/>
			<arg value="- -output=generated/SQLParser.java"/> -->
		<exec executable="bison" dir="${basedir}">
			<!--<arg value="- -xml=generated/pl.xml"/>
			<arg value="- -report=state,lookahead,itemset"/>
			<arg value="- -report-file=generated/pl.report"/>-->
			<arg value="generated/pl.bg"/>
		</exec>
    	<delete file="pl.tab.bg"></delete>
	</target>
	
    <target name="generateLexer" depends="generateParser">  
		<!-- SQL lexer : SQL transducer is generated from it -->
		<jflex
			file="generated/pl.flex"
    		destdir="generated" 
			time="on"
    		nobak="on"
			pack="off"
		/>
		<!-- Generate a class which will generate the data for a transducer -->
    	<java classpath="${lexerProject}/bin" classname="Generator">
    		<arg file="generated/"/>
    		<arg value="PLLexer"/>
    		<arg file="generated/"/>
    		<arg value="PLLexerGen"/>
    		<arg value="generated/pl.keywords"/>
    	</java>
		<!-- Compile the generated class -->
    	<javac 
    		srcdir="generated" 
    		classpath="generated" 
    		destdir="bin">
    	</javac>
		<!-- Run the compiled class and store the results as a *.java file -->
    	<mkdir dir="generated/pl/lexer"/>
    	<java 
    		classpath="bin" 
    		classname="PLLexerGen" 
    		output="generated/pl/lexer/PLLexerData.java">
    		<arg value="pl.lexer"/>
    		<arg value="PLLexerData"/>
    	</java>
	</target>	

</project>
